<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Bird</title>
    <link rel="icon" href="D:/Flappy-Bird-updated/assets/favicon.png"> 
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="preloader">
        <div id="preloader-content">
            <h1>Flappy Bird</h1>
            <div id="progress-bar-container">
                <div id="progress-bar"></div>
            </div>
            <p id="progress-text">0%</p>
        </div>
    </div>   

    <div id="Mainmenu">
        <h2>Menu</h2>
        <button onclick="startplay()">Start Play</button>
        <button onclick="showHighestScores()">Highest Scores</button>
        <button onclick="showDifficultyScreen()">Difficulty 
            <span class="material-symbols-outlined">radio_button_checked</span> 
            <span id="selectedDifficulty"></span>
        </button>
        <button onclick="showAbout()">About</button>
        <button onclick="showReset()">Reset</button>
        <button id="fullScreenBtn" onclick="toggleFullScreen()">Full Screen</button>
        
        <!-- Play Music Button -->
        <button id="musicToggleBtn" onclick="toggleMusic()">Play Music</button>
    </div>

    <div id="highestScoresOverlay" class="overlay">
        <h2>Highest Scores</h2>
        <p>Easy: <span id="easyScore">0</span></p>
        <p>Hard: <span id="hardScore">0</span></p>
        <p>Advanced: <span id="advancedScore">0</span></p>
        <button onclick="closeOverlay()">Close</button>
    </div>

    <div id="difficultyScreen" class="overlay">
        <h2>Select Difficulty</h2>
        <button onclick="startGame('easy')">Easy</button>
        <button onclick="startGame('hard')">Hard</button>
        <button onclick="startGame('advanced')">Advanced</button>
        <button onclick="closeOverlay()">Close</button>
    </div>

    <div id="about" class="overlay">
        <h2>About</h2>
        <p>Flappy Bird is a 2013 casual mobile game developed by Vietnamese video game artist and programmer Dong Nguyen.</p>
        <p>This version was created by Deepak Pal, who aimed to bring a fun and engaging experience to players.</p>
        <button onclick="closeOverlay()">Close</button>
    </div>

    <div id="reset" class="overlay">
        <h3>Confirm Reset</h3>
        <p>Are you sure you want to reset? This action cannot be undone.</p>
        <div class="confirmBtn">
            <button onclick="closeOverlay()">Close</button>
            <button onclick="confirmResetBtn()">Reset</button>
        </div>
    </div>

    <canvas id="gameCanvas" width="800" height="600" style="display: none;"></canvas>

    <div id="gameOverScreen" class="overlay">
        <h2>Game Over</h2>
        <hr>
        <p id="finalScore"></p>
        <button id="resetBtn" onclick="restartGame()">Restart</button>
        <button onclick="showMainMenu()">Menu</button>
    </div>

    <!-- Audio Element for Background Music -->
    <audio id="background-music" loop autoplay muted>
        <source src="assets/background_music.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <script>
// Initialize music and button references
const music = document.getElementById('background-music');
const musicToggleBtn = document.getElementById('musicToggleBtn');

// Load user's previous preference from LocalStorage
window.addEventListener('load', () => {
    const isMusicPlaying = localStorage.getItem('musicPlaying') === 'true';
    if (isMusicPlaying) {
        unmuteMusic();  // Resume music if previously playing
    } else {
        music.muted = true;  // Start muted by default
    }

    // Try to play (if autoplay allowed); log message if blocked
    music.play().catch(() => {
        console.log("Autoplay blocked. Waiting for user interaction.");
    });
});

// Toggle Play/Pause Music with button
function toggleMusic() {
    if (music.paused) {
        unmuteMusic();
    } else {
        pauseMusic();
    }
}

// Unmute and Play Music
function unmuteMusic() {
    music.muted = false;  // Unmute the audio
    music.play().then(() => {
        musicToggleBtn.textContent = 'Pause Music';  // Update button text
        localStorage.setItem('musicPlaying', 'true');  // Save state
    }).catch((error) => {
        console.error("Error playing music:", error);
    });
}

// Pause Music
function pauseMusic() {
    music.pause();  // Pause the audio
    musicToggleBtn.textContent = 'Play Music';  // Update button text
    localStorage.setItem('musicPlaying', 'false');  // Save state
}

    </script>

    <script src="flappy.js"></script>
</body>
</html>
